<!--pages/admin/problem-monitor/problem-monitor.wxml-->
<view class="monitor-container">
  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="stats-overview">
    <view class="stats-title">
      <text class="title">é—®é¢˜ç›‘æ§æ¦‚è§ˆ</text>
      <text class="refresh-btn" bindtap="refreshData">åˆ·æ–°</text>
    </view>
    
    <view class="stats-grid">
      <view class="stats-item">
        <text class="stats-number">{{overviewStats.total}}</text>
        <text class="stats-label">æ€»é—®é¢˜æ•°</text>
      </view>
      
      <view class="stats-item">
        <text class="stats-number">{{overviewStats.pending}}</text>
        <text class="stats-label">å¾…å¤„ç†</text>
      </view>
      
      <view class="stats-item">
        <text class="stats-number">{{overviewStats.processing}}</text>
        <text class="stats-label">å¤„ç†ä¸­</text>
      </view>
      
      <view class="stats-item">
        <text class="stats-number">{{overviewStats.fixed}}</text>
        <text class="stats-label">å·²æ•´æ”¹</text>
      </view>
    </view>
    
    <view class="fix-rate">
      <text class="rate-label">æ•´æ”¹ç‡</text>
      <text class="rate-value">{{overviewStats.fixRate}}%</text>
    </view>
  </view>

  <!-- ç­›é€‰æ¡ä»¶ -->
  <view class="filter-section">
    <view class="filter-row">
      <picker 
        class="filter-picker" 
        range="{{communities}}" 
        range-key="name" 
        value="{{selectedCommunityIndex}}" 
        bindchange="onCommunityChange"
      >
        <view class="picker-display">
          <text class="picker-text">{{selectedCommunityText}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
      
      <picker 
        class="filter-picker" 
        range="{{statusOptions}}" 
        range-key="label" 
        value="{{selectedStatusIndex}}" 
        bindchange="onStatusChange"
      >
        <view class="picker-display">
          <text class="picker-text">{{selectedStatusText}}</text>
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>
  </view>

  <!-- é—®é¢˜åˆ—è¡¨ -->
  <view class="problem-list">
    <view class="list-header">
      <text class="list-title">é—®é¢˜åˆ—è¡¨</text>
      <text class="list-count">å…±{{problems.length}}ä¸ªé—®é¢˜</text>
    </view>

    <view class="problem-item" wx:for="{{problems}}" wx:key="id" bindtap="viewProblemDetail" data-id="{{item.id}}">
      <view class="problem-header">
        <text class="problem-title">{{item.title}}</text>
        <view class="problem-status {{item.status}}">
          <text class="status-text">{{item.statusText}}</text>
        </view>
      </view>
      
      <text class="problem-desc">{{item.description}}</text>
      
      <view class="problem-meta">
        <view class="meta-item">
          <text class="meta-label">ç¤¾åŒº:</text>
          <text class="meta-value">{{item.communityName}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">åˆ†ç±»:</text>
          <text class="meta-value">{{item.categoryText}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">ä¸¥é‡ç¨‹åº¦:</text>
          <text class="meta-value severity-{{item.severity}}">{{item.severityText}}</text>
        </view>
      </view>
      
      <view class="problem-photos">
        <image 
          wx:for="{{item.photos}}" 
          wx:key="*this" 
          src="{{item}}" 
          mode="aspectFill"
          bindtap="previewPhoto" 
          data-photos="{{item.photos}}" 
          data-current="{{item}}"
        ></image>
      </view>
      
      <view class="problem-footer">
        <text class="problem-time">{{item.createTime}}</text>
        <view class="problem-actions">
          <view class="action-btn" wx:if="{{item.status === 'pending'}}" bindtap="updateStatus" data-id="{{item.id}}" data-status="processing" catchtap="true">
            <text class="action-text">å¼€å§‹å¤„ç†</text>
          </view>
          <view class="action-btn" wx:if="{{item.status === 'processing'}}" bindtap="updateStatus" data-id="{{item.id}}" data-status="fixed" catchtap="true">
            <text class="action-text">æ ‡è®°æ•´æ”¹</text>
          </view>
          <view class="action-btn" wx:if="{{item.status === 'fixed'}}" bindtap="updateStatus" data-id="{{item.id}}" data-status="closed" catchtap="true">
            <text class="action-text">å…³é—­é—®é¢˜</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{problems.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">æš‚æ— é—®é¢˜æ•°æ®</text>
      <text class="empty-desc">å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°é—®é¢˜</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>
