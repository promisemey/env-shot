<!--pages/user/user.wxml-->
<view class="page-container">
  <!-- 用户信息头部 -->
  <view class="user-header">
    <view class="header-content">
      <view class="user-info">
        <view class="user-avatar-wrapper">
          <t-avatar 
            size="120rpx" 
            image="{{userInfo.avatar || '/images/default-avatar.png'}}"
            class="user-avatar"
          ></t-avatar>
          <view class="avatar-badge">
            <t-icon name="user" size="24rpx" color="#ffffff"></t-icon>
          </view>
        </view>
        <view class="user-details">
          <text class="user-name">{{userInfo.name || '用户'}}</text>
          <text class="user-phone">{{userInfo.phone}}</text>
          <view class="user-role-badge">
            <t-icon name="medal" size="20rpx" color="#ffffff"></t-icon>
            <text class="user-role">社区用户</text>
          </view>
        </view>
      </view>
      <view class="user-actions">
        <view class="action-btn" bindtap="editProfile">
          <t-icon name="edit" size="28rpx" color="#ffffff"></t-icon>
        </view>
      </view>
    </view>
  </view>

  <!-- 社区信息 -->
  <view class="community-info" wx:if="{{userCommunity}}">
    <view class="section-header">
      <view class="section-title">
        <t-icon name="location" size="28rpx" color="var(--td-brand-color)"></t-icon>
        <text class="title">所属社区</text>
      </view>
    </view>
    
    <view class="community-card">
      <view class="community-icon">
        <t-icon name="home" size="48rpx" color="var(--td-brand-color)"></t-icon>
      </view>
      <view class="community-details">
        <text class="community-name">{{userCommunity.name}}</text>
        <text class="community-address">{{userCommunity.address}}</text>
      </view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="user-menu">
    <view class="section-header">
      <view class="section-title">
        <t-icon name="apps" size="28rpx" color="var(--td-brand-color)"></t-icon>
        <text class="title">功能菜单</text>
      </view>
    </view>
    
    <view class="menu-grid">
      <view class="menu-card" bindtap="navigateTo" data-url="/pages/user/problem-list/problem-list">
        <view class="card-icon">
          <t-icon name="view-list" size="56rpx" color="#0052d9"></t-icon>
        </view>
        <view class="card-content">
          <text class="card-title">问题列表</text>
          <text class="card-desc">查看社区环境问题</text>
        </view>
        <view class="card-arrow">
          <t-icon name="chevron-right" size="32rpx" color="var(--td-gray-color-4)"></t-icon>
        </view>
      </view>

      <view class="menu-card" bindtap="navigateTo" data-url="/pages/user/upload-fix/upload-fix">
        <view class="card-icon">
          <t-icon name="check-circle" size="56rpx" color="#52c41a"></t-icon>
        </view>
        <view class="card-content">
          <text class="card-title">上传整改</text>
          <text class="card-desc">上传问题整改照片</text>
        </view>
        <view class="card-arrow">
          <t-icon name="chevron-right" size="32rpx" color="var(--td-gray-color-4)"></t-icon>
        </view>
      </view>
    </view>
  </view>

  <!-- 统计信息 -->
  <view class="user-stats">
    <view class="section-header">
      <view class="section-title">
        <t-icon name="chart-pie" size="28rpx" color="var(--td-brand-color)"></t-icon>
        <text class="title">我的贡献</text>
      </view>
    </view>
    
    <view class="stats-grid">
      <view class="stats-card">
        <view class="stats-icon">
          <t-icon name="layers" size="40rpx" color="#0052d9"></t-icon>
        </view>
        <text class="stats-number">{{userStats.reportedProblems}}</text>
        <text class="stats-label">上报问题</text>
      </view>
      
      <view class="stats-card">
        <view class="stats-icon">
          <t-icon name="check-circle" size="40rpx" color="#00a870"></t-icon>
        </view>
        <text class="stats-number">{{userStats.fixedProblems}}</text>
        <text class="stats-label">整改问题</text>
      </view>
      
      <view class="stats-card">
        <view class="stats-icon">
          <t-icon name="time" size="40rpx" color="#ed7b2f"></t-icon>
        </view>
        <text class="stats-number">{{userStats.pendingProblems}}</text>
        <text class="stats-label">待整改</text>
      </view>
    </view>
  </view>

  <!-- 最近活动 -->
  <view class="recent-activity">
    <view class="section-header">
      <view class="section-title">
        <t-icon name="time" size="28rpx" color="var(--td-brand-color)"></t-icon>
        <text class="title">最近活动</text>
      </view>
      <view class="section-action" bindtap="navigateTo" data-url="/pages/user/problem-list/problem-list">
        <text class="action-text">更多</text>
        <t-icon name="chevron-right" size="24rpx" color="var(--td-gray-color-4)"></t-icon>
      </view>
    </view>
    
    <view class="activity-list">
      <view 
        class="activity-item" 
        wx:for="{{recentActivities}}" 
        wx:key="id"
      >
        <view class="activity-icon">
          <t-icon name="error-circle" size="32rpx" color="#e34d59"></t-icon>
        </view>
        
        <view class="activity-content">
          <text class="activity-title">{{item.title}}</text>
          <text class="activity-desc">{{item.description}}</text>
          <text class="activity-time">{{item.time}}</text>
        </view>
        
        <view class="activity-status">
          <t-tag 
            theme="{{item.status === 'pending' ? 'warning' : item.status === 'fixed' ? 'success' : 'default'}}"
            size="small"
          >
            {{item.statusText}}
          </t-tag>
        </view>
      </view>
      
      <view class="empty-state" wx:if="{{recentActivities.length === 0}}">
        <view class="empty-icon">
          <t-icon name="info-circle" size="80rpx" color="var(--td-gray-color-4)"></t-icon>
        </view>
        <text class="empty-text">暂无活动记录</text>
        <text class="empty-desc">开始参与社区环境管理</text>
      </view>
    </view>
  </view>

  <!-- 退出登录 -->
  <view class="logout-section">
    <view class="logout-card">
      <view class="logout-icon">
        <t-icon name="logout" size="32rpx" color="#d54941"></t-icon>
      </view>
      <text class="logout-text" bindtap="logout">退出登录</text>
    </view>
  </view>
</view>
