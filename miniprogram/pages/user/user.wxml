<!--pages/user/user.wxml-->
<view class="user-container">
  <!-- 用户信息头部 -->
  <view class="user-header">
    <view class="user-info">
      <t-avatar 
        size="120rpx" 
        image="{{userInfo.avatar || '/images/default-avatar.png'}}"
        class="user-avatar"
      ></t-avatar>
      <view class="user-details">
        <text class="user-name">{{userInfo.name || '用户'}}</text>
        <text class="user-phone">{{userInfo.phone}}</text>
        <text class="user-role">社区用户</text>
      </view>
    </view>
    <view class="user-actions">
      <t-button theme="text" size="small" bindtap="editProfile">
        <t-icon name="edit" size="24rpx" slot="icon"></t-icon>
        编辑
      </t-button>
    </view>
  </view>

  <!-- 社区信息 -->
  <view class="community-info" wx:if="{{userCommunity}}">
    <view class="community-header">
      <t-icon name="location" size="32rpx" color="#0052d9"></t-icon>
      <text class="community-title">所属社区</text>
    </view>
    <text class="community-name">{{userCommunity.name}}</text>
    <text class="community-address">{{userCommunity.address}}</text>
  </view>

  <!-- 功能菜单 -->
  <view class="user-menu">
    <t-cell-group>
      <t-cell 
        bindtap="navigateTo" 
        data-url="/pages/user/problem-list/problem-list"
        title="问题列表"
        description="查看社区环境问题"
        left-icon="file-list"
        right-icon="chevron-right"
        hover="{{true}}"
      >
        <t-icon name="file-list" slot="left-icon" size="48rpx" color="#0052d9"></t-icon>
      </t-cell>

      <t-cell 
        bindtap="navigateTo" 
        data-url="/pages/user/upload-fix/upload-fix"
        title="上传整改"
        description="上传问题整改照片"
        left-icon="check-circle"
        right-icon="chevron-right"
        hover="{{true}}"
      >
        <t-icon name="check-circle" slot="left-icon" size="48rpx" color="#52c41a"></t-icon>
      </t-cell>
    </t-cell-group>
  </view>

  <!-- 统计信息 -->
  <view class="user-stats">
    <view class="stats-title">
      <t-icon name="chart-pie" size="32rpx" color="#0052d9"></t-icon>
      <text class="title">我的贡献</text>
    </view>
    
    <t-grid column="3" border="{{false}}">
      <t-grid-item>
        <view class="stats-item">
          <text class="stats-number">{{userStats.reportedProblems}}</text>
          <text class="stats-label">上报问题</text>
        </view>
      </t-grid-item>
      
      <t-grid-item>
        <view class="stats-item">
          <text class="stats-number">{{userStats.fixedProblems}}</text>
          <text class="stats-label">整改问题</text>
        </view>
      </t-grid-item>
      
      <t-grid-item>
        <view class="stats-item">
          <text class="stats-number">{{userStats.pendingProblems}}</text>
          <text class="stats-label">待整改</text>
        </view>
      </t-grid-item>
    </t-grid>
  </view>

  <!-- 最近活动 -->
  <view class="recent-activity">
    <view class="activity-header">
      <view class="activity-title-wrapper">
        <t-icon name="time" size="32rpx" color="#0052d9"></t-icon>
        <text class="activity-title">最近活动</text>
      </view>
      <t-button theme="text" size="small" bindtap="navigateTo" data-url="/pages/user/problem-list/problem-list">
        更多
        <t-icon name="chevron-right" size="24rpx"></t-icon>
      </t-button>
    </view>
    
    <t-cell-group>
      <t-cell 
        wx:for="{{recentActivities}}" 
        wx:key="id"
        title="{{item.title}}"
        description="{{item.description}}"
        note="{{item.time}}"
        left-icon="{{item.iconName}}"
        hover="{{true}}"
      >
        <t-icon name="{{item.iconName}}" slot="left-icon" size="32rpx" color="#0052d9"></t-icon>
        <view slot="right-icon">
          <t-tag 
            theme="{{item.status === 'pending' ? 'warning' : item.status === 'fixed' ? 'success' : 'default'}}"
            size="small"
          >
            {{item.statusText}}
          </t-tag>
        </view>
      </t-cell>
      
      <t-cell wx:if="{{recentActivities.length === 0}}" title="暂无活动记录" description="开始参与社区环境管理">
        <t-icon name="info-circle" slot="left-icon" color="#999"></t-icon>
      </t-cell>
    </t-cell-group>
  </view>

  <!-- 退出登录 -->
  <view class="logout-section">
    <t-button theme="danger" size="large" block="{{true}}" bindtap="logout">
      <t-icon name="logout" size="32rpx" slot="icon"></t-icon>
      退出登录
    </t-button>
  </view>
</view>
