<!--pages/index/index.wxml-->
<view class="container">
  <!-- 顶部欢迎区域 -->
  <view class="welcome-section">
    <view class="welcome-content">
      <t-image 
        class="welcome-bg" 
        src="{{userInfo.avatar || '/images/default-avatar.png'}}" 
        width="100%" 
        height="300rpx" 
        mode="aspectFill"
      ></t-image>
      <view class="welcome-overlay">
        <text class="welcome-text">欢迎使用</text>
        <text class="app-name">社区环境管理</text>
        <text class="user-info">{{userInfo.name || '用户'}}，{{userInfo.role === 'admin' ? '管理员' : '社区用户'}}</text>
      </view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="section-title">
      <t-icon name="app" size="32rpx" color="#0052d9"></t-icon>
      <text class="title">功能菜单</text>
    </view>
    
    <t-grid column="3" border="{{false}}" hover="{{true}}">
      <!-- 管理员功能 -->
      <block wx:if="{{userInfo.role === 'admin'}}">
        <t-grid-item bindtap="navigateTo" data-url="/pages/admin/community-select/community-select">
          <view class="menu-item">
            <t-icon name="home" size="48rpx" color="#0052d9"></t-icon>
            <text class="menu-text">选择社区</text>
          </view>
        </t-grid-item>
        
        <t-grid-item bindtap="navigateTo" data-url="/pages/admin/problem-upload/problem-upload">
          <view class="menu-item">
            <t-icon name="camera" size="48rpx" color="#e34d59"></t-icon>
            <text class="menu-text">上传问题</text>
          </view>
        </t-grid-item>
        
        <t-grid-item bindtap="navigateTo" data-url="/pages/admin/problem-monitor/problem-monitor">
          <view class="menu-item">
            <t-icon name="chart" size="48rpx" color="#52c41a"></t-icon>
            <text class="menu-text">问题监控</text>
          </view>
        </t-grid-item>
      </block>

      <!-- 普通用户功能 -->
      <block wx:else>
        <t-grid-item bindtap="navigateTo" data-url="/pages/user/problem-list/problem-list">
          <view class="menu-item">
            <t-icon name="file-list" size="48rpx" color="#0052d9"></t-icon>
            <text class="menu-text">问题列表</text>
          </view>
        </t-grid-item>
        
        <t-grid-item bindtap="navigateTo" data-url="/pages/user/upload-fix/upload-fix">
          <view class="menu-item">
            <t-icon name="check-circle" size="48rpx" color="#52c41a"></t-icon>
            <text class="menu-text">上传整改</text>
          </view>
        </t-grid-item>
      </block>
    </t-grid>
  </view>

  <!-- 统计信息 -->
  <view class="stats-section">
    <view class="section-title">
      <t-icon name="chart-pie" size="32rpx" color="#0052d9"></t-icon>
      <text class="title">数据统计</text>
    </view>
    
    <t-grid column="4" border="{{false}}">
      <t-grid-item>
        <view class="stats-item">
          <text class="stats-number">{{stats.totalProblems}}</text>
          <text class="stats-label">总问题数</text>
        </view>
      </t-grid-item>
      
      <t-grid-item>
        <view class="stats-item">
          <text class="stats-number">{{stats.pendingProblems}}</text>
          <text class="stats-label">待处理</text>
        </view>
      </t-grid-item>
      
      <t-grid-item>
        <view class="stats-item">
          <text class="stats-number">{{stats.fixedProblems}}</text>
          <text class="stats-label">已整改</text>
        </view>
      </t-grid-item>
      
      <t-grid-item>
        <view class="stats-item">
          <text class="stats-number">{{stats.fixRate}}%</text>
          <text class="stats-label">整改率</text>
        </view>
      </t-grid-item>
    </t-grid>
  </view>

  <!-- 最近问题 -->
  <view class="recent-section">
    <view class="section-title">
      <t-icon name="time" size="32rpx" color="#0052d9"></t-icon>
      <text class="title">最近问题</text>
      <t-button theme="text" size="small" bindtap="navigateTo" data-url="/pages/user/problem-list/problem-list">
        更多
        <t-icon name="chevron-right" size="24rpx"></t-icon>
      </t-button>
    </view>
    
    <t-cell-group>
      <t-cell 
        wx:for="{{recentProblems}}" 
        wx:key="id" 
        bindtap="viewProblemDetail" 
        data-id="{{item.id}}"
        title="{{item.title}}"
        description="{{item.description}}"
        note="{{item.createTime}}"
        left-icon="file"
        right-icon="chevron-right"
        hover="{{true}}"
      >
        <view slot="right-icon">
          <t-tag 
            theme="{{item.status === 'pending' ? 'warning' : item.status === 'fixed' ? 'success' : 'default'}}"
            size="small"
          >
            {{item.statusText}}
          </t-tag>
        </view>
        <view slot="description">
          <t-image 
            src="{{item.photos[0]}}" 
            width="80rpx" 
            height="80rpx" 
            shape="round"
            mode="aspectFill"
          ></t-image>
        </view>
      </t-cell>
      
      <t-cell wx:if="{{recentProblems.length === 0}}" title="暂无问题记录" description="点击上方功能菜单开始使用">
        <t-icon name="info-circle" slot="left-icon" color="#999"></t-icon>
      </t-cell>
    </t-cell-group>
  </view>
</view>